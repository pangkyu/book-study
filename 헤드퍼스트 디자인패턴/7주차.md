## ìƒíƒœ íŒ¨í„´

ê°ì²´ì˜ ë‚´ë¶€ ìƒíƒœì— ë”°ë¼ ë™ì‘ì„ ë³€ê²½í•˜ëŠ” íŒ¨í„´
=> ìƒíƒœë§ˆë‹¤ ë‹¤ë¥´ê²Œ í–‰ë™í•˜ëŠ” ê°ì²´ë¥¼ ê¹”ë”í•˜ê²Œ ë§Œë“¤ê¸°

- ìƒíƒœì— ë”°ë¼ í–‰ë™ ìì²´ê°€ ë³€í•¨
- ìƒíƒœê°€ ìë™ìœ¼ë¡œ ì „í™˜ë¨
- ì»¨í…ìŠ¤íŠ¸ê°€ ìƒíƒœë¥¼ ì•Œê³  ìˆìŒ

**ì‚¬ìš© ì‹œê¸°**

- ê°ì²´ í–‰ë™ì´ ìƒíƒœì— ë”°ë¼ ê°ê¸° ë‹¤ë¥¸ ë™ì‘ì„ í•  ë•Œ
- ìƒíƒœ ë° ì „í™˜ì— ê²°ì²˜ ëŒ€ê·œëª¨ ì¡°ê±´ ë¶„ê¸° ì½”ë“œ & ì¤‘ë³µ ì½”ë“œê°€ ë§ì„ ë•Œ
- ëŸ°íƒ€ì„ë‹¨ì—ì„œ ê°ì²´ ìƒíƒœë¥¼ ìœ ë™ì ìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•  ë•Œ
- ì¡°ê±´ë¬¸ì˜ ê° ë¶„ê¸°ë¥¼ ë³„ë„ í´ë˜ìŠ¤ì— ë„£ëŠ” ê²ƒì´ ìƒíƒœ íŒ¨í„´ì˜ í•µì‹¬ì…ë‹ˆë‹¤.

**ì¥ì **

- ìƒíƒœì— ë”°ë¥¸ ë™ì‘ì„ ê°œë³„ í´ë˜ìŠ¤ë¡œ ì˜®ê²¨ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- í•˜ë‚˜ì˜ ìƒíƒœ ê°ì²´ë§Œ ì‚¬ìš©í•˜ì—¬ ìƒíƒœ ë³€ê²½ì„ í•˜ë¯€ë¡œ ì¼ê´€ì„± ì—†ëŠ” ìƒíƒœ ì£¼ì…ì„ ë°”ì§€í•˜ëŠ”ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.

**ë‹¨ì **

- ìƒíƒœë³„ë¡œ í´ë˜ìŠ¤ë¥¼ ìƒì„œí•˜ë¯€ë¡œ ê´€ë¦¬í•´ì•¼í•˜ëŠ” í´ë˜ìŠ¤ ìˆ˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤.
- ê°ì²´ì— ì ìš©í•  ìƒíƒœê°€ ëª‡ ê°€ì§€ ë°–ì— ì—†ê±°ë‚˜ ê±°ì˜ ìƒíƒœ ë³€ê²½ì´ ì´ë¤„ì§€ì§€ ì•ŠëŠ” ê²½ìš° íŒ¨í„´ì„ ì ìš©í•˜ëŠ” ê²ƒì´ ê³¼ë„í•©ë‹ˆë‹¤.

bad case

```js
class VendingMachine {
  private state: string = 'NO_COIN';
  private balance: number = 0;

  insertCoin(amount: number): void {
    // ìƒíƒœë§ˆë‹¤ ifë¬¸ìœ¼ë¡œ ë¶„ê¸°
    if (this.state === 'NO_COIN') {
      this.balance += amount;
      this.state = 'HAS_COIN';
      console.log(`${amount}ì› íˆ¬ì…ë¨`);
    } else if (this.state === 'HAS_COIN') {
      this.balance += amount;
      console.log(`${amount}ì› ì¶”ê°€ë¨. ì”ì•¡: ${this.balance}ì›`);
    } else if (this.state === 'DISPENSING') {
      console.log('ìƒí’ˆ ë°°ì¶œ ì¤‘ì…ë‹ˆë‹¤.');
    }
  }

  selectProduct(price: number): void {
    // ë˜ ifë¬¸ ë©ì–´ë¦¬
    if (this.state === 'NO_COIN') {
      console.log('ë™ì „ì„ ë„£ì–´ì£¼ì„¸ìš”.');
    } else if (this.state === 'HAS_COIN') {
      if (this.balance >= price) {
        this.balance -= price;
        this.state = 'DISPENSING';
        console.log('ìƒí’ˆ ì¤€ë¹„ ì¤‘...');
        this.dispense();
      } else {
        console.log('ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
      }
    } else if (this.state === 'DISPENSING') {
      console.log('ì´ë¯¸ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤.');
    }
  }

  refund(): void {
    // ë˜ ifë¬¸...
    if (this.state === 'NO_COIN') {
      console.log('ë°˜í™˜í•  ë™ì „ì´ ì—†ìŠµë‹ˆë‹¤.');
    } else if (this.state === 'HAS_COIN') {
      console.log(`${this.balance}ì› ë°˜í™˜ë¨`);
      this.balance = 0;
      this.state = 'NO_COIN';
    } else if (this.state === 'DISPENSING') {
      console.log('ì²˜ë¦¬ ì¤‘ì—ëŠ” ë°˜í™˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }
  }

  private dispense(): void {
    console.log('ìƒí’ˆì´ ë‚˜ì™”ìŠµë‹ˆë‹¤!');
    this.state = 'NO_COIN';
  }
}

// ë¬¸ì œì :
// 1. ëª¨ë“  ë©”ì„œë“œì— ifë¬¸ ë©ì–´ë¦¬
// 2. ìƒˆ ìƒíƒœ ì¶”ê°€ ì‹œ ëª¨ë“  ë©”ì„œë“œ ìˆ˜ì • í•„ìš”
// 3. ë³µì¡ë„ê°€ n(ìƒíƒœ) Ã— m(ë©”ì„œë“œ)ë¡œ ì¦ê°€
// 4. ìƒíƒœ ì „í™˜ ë¡œì§ì´ ì—¬ê¸°ì €ê¸° í©ì–´ì ¸ ìˆìŒ
```

good case

```js
// ìƒíƒœ ì¸í„°í˜ì´ìŠ¤
interface VendingMachineState {
  insertCoin(machine: VendingMachine, amount: number): void;
  selectProduct(machine: VendingMachine, price: number): void;
  refund(machine: VendingMachine): void;
  dispense(machine: VendingMachine): void;
}

// Context (ìíŒê¸°)
class VendingMachine {
  private state: VendingMachineState;
  private balance: number = 0;

  constructor() {
    // ì´ˆê¸° ìƒíƒœ
    this.state = new NoCoinState();
  }

  // ìƒíƒœ ì „í™˜
  setState(state: VendingMachineState): void {
    this.state = state;
    console.log(`[ìƒíƒœ ë³€ê²½] ${state.constructor.name}`);
  }

  getBalance(): number {
    return this.balance;
  }

  addBalance(amount: number): void {
    this.balance += amount;
  }

  deductBalance(amount: number): void {
    this.balance -= amount;
  }

  resetBalance(): void {
    this.balance = 0;
  }

  // í˜„ì¬ ìƒíƒœì—ê²Œ ìœ„ì„
  insertCoin(amount: number): void {
    this.state.insertCoin(this, amount);
  }

  selectProduct(price: number): void {
    this.state.selectProduct(this, price);
  }

  refund(): void {
    this.state.refund(this);
  }

  dispense(): void {
    this.state.dispense(this);
  }
}

// êµ¬ì²´ì ì¸ ìƒíƒœ 1: ë™ì „ ì—†ìŒ
class NoCoinState implements VendingMachineState {
  insertCoin(machine: VendingMachine, amount: number): void {
    machine.addBalance(amount);
    console.log(`${amount}ì›ì´ íˆ¬ì…ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    machine.setState(new HasCoinState());  // ìƒíƒœ ì „í™˜
  }

  selectProduct(machine: VendingMachine, price: number): void {
    console.log('ë™ì „ì„ ë¨¼ì € ë„£ì–´ì£¼ì„¸ìš”.');
  }

  refund(machine: VendingMachine): void {
    console.log('ë°˜í™˜í•  ë™ì „ì´ ì—†ìŠµë‹ˆë‹¤.');
  }

  dispense(machine: VendingMachine): void {
    console.log('ìƒí’ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
  }
}

// êµ¬ì²´ì ì¸ ìƒíƒœ 2: ë™ì „ ìˆìŒ
class HasCoinState implements VendingMachineState {
  insertCoin(machine: VendingMachine, amount: number): void {
    machine.addBalance(amount);
    console.log(`${amount}ì›ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. ì”ì•¡: ${machine.getBalance()}ì›`);
    // ìƒíƒœëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€
  }

  selectProduct(machine: VendingMachine, price: number): void {
    if (machine.getBalance() >= price) {
      machine.deductBalance(price);
      console.log('ìƒí’ˆì„ ì¤€ë¹„í•©ë‹ˆë‹¤...');
      machine.setState(new DispensingState());  // ìƒíƒœ ì „í™˜
      machine.dispense();
    } else {
      console.log(`ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (í•„ìš”: ${price}ì›, í˜„ì¬: ${machine.getBalance()}ì›)`);
    }
  }

  refund(machine: VendingMachine): void {
    const balance = machine.getBalance();
    console.log(`${balance}ì›ì´ ë°˜í™˜ë©ë‹ˆë‹¤.`);
    machine.resetBalance();
    machine.setState(new NoCoinState());  // ìƒíƒœ ì „í™˜
  }

  dispense(machine: VendingMachine): void {
    console.log('ìƒí’ˆì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
  }
}

// êµ¬ì²´ì ì¸ ìƒíƒœ 3: ìƒí’ˆ ë°°ì¶œ ì¤‘
class DispensingState implements VendingMachineState {
  insertCoin(machine: VendingMachine, amount: number): void {
    console.log('ìƒí’ˆ ë°°ì¶œ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.');
  }

  selectProduct(machine: VendingMachine, price: number): void {
    console.log('ì´ë¯¸ ìƒí’ˆì„ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤.');
  }

  refund(machine: VendingMachine): void {
    console.log('ë°°ì¶œ ì¤‘ì—ëŠ” ë°˜í™˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
  }

  dispense(machine: VendingMachine): void {
    console.log('ğŸ¥¤ ìƒí’ˆì´ ë‚˜ì™”ìŠµë‹ˆë‹¤!');

    // ì”ì•¡ í™•ì¸
    if (machine.getBalance() > 0) {
      console.log(`ì”ì•¡ ${machine.getBalance()}ì›ì´ ë‚¨ì•˜ìŠµë‹ˆë‹¤.`);
      machine.setState(new HasCoinState());  // ë™ì „ ìˆìŒ ìƒíƒœë¡œ
    } else {
      machine.setState(new NoCoinState());  // ë™ì „ ì—†ìŒ ìƒíƒœë¡œ
    }
  }
}

// ì‚¬ìš©
const vendingMachine = new VendingMachine();

vendingMachine.selectProduct(1000);  // "ë™ì „ì„ ë¨¼ì € ë„£ì–´ì£¼ì„¸ìš”."
vendingMachine.insertCoin(500);      // "500ì›ì´ íˆ¬ì…ë˜ì—ˆìŠµë‹ˆë‹¤." â†’ HasCoinState
vendingMachine.insertCoin(500);      // "500ì›ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. ì”ì•¡: 1000ì›"
vendingMachine.selectProduct(800);   // "ìƒí’ˆì„ ì¤€ë¹„í•©ë‹ˆë‹¤..." â†’ DispensingState â†’ "ìƒí’ˆì´ ë‚˜ì™”ìŠµë‹ˆë‹¤!" â†’ HasCoinState
vendingMachine.refund();             // "200ì›ì´ ë°˜í™˜ë©ë‹ˆë‹¤." â†’ NoCoinState
```

**ìƒíƒœ íŒ¨í„´ì˜ ì¥ì **

- ê° ìƒíƒœ ë¡œì§ì´ ë¶„ë¦¬ë©ë‹ˆë‹¤.
- ìƒˆ ìƒíƒœ ì¶”ê°€ê°€ ì‰½ìŠµë‹ˆë‹¤.

```js
// ìƒˆ ìƒíƒœ ì¶”ê°€ (ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ì—†ìŒ!)
class MaintenanceState implements VendingMachineState {
  insertCoin(machine: VendingMachine, amount: number): void {
    console.log("ì ê²€ ì¤‘ì…ë‹ˆë‹¤.");
  }

  selectProduct(machine: VendingMachine, price: number): void {
    console.log("ì ê²€ ì¤‘ì…ë‹ˆë‹¤.");
  }

  refund(machine: VendingMachine): void {
    console.log("ì ê²€ ì¤‘ì…ë‹ˆë‹¤.");
  }

  dispense(machine: VendingMachine): void {
    console.log("ì ê²€ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
    machine.setState(new NoCoinState());
  }
}
```

- ìƒíƒœ ì „í™˜ì´ ëª…í™•í•©ë‹ˆë‹¤.

```js
// ìƒíƒœ ì „í™˜ì´ ê° ìƒíƒœ í´ë˜ìŠ¤ ì•ˆì— ìº¡ìŠí™”ë¨
class HasCoinState {
  selectProduct(machine: VendingMachine, price: number): void {
    if (machine.getBalance() >= price) {
      machine.setState(new DispensingState()); // ëª…í™•í•œ ì „í™˜
    }
  }
}
```

---

**ì˜ˆì‹œ ë¼ì´ë¸ŒëŸ¬ë¦¬**
react hook form

```js
import { useForm } from "react-hook-form";

function LoginForm() {
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting, isValid }, // ğŸ‘ˆ ìƒíƒœë³„ UI
  } = useForm();

  // í¼ ìƒíƒœì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘
  // - pristine (ì´ˆê¸°) â†’ ëª¨ë“  í•„ë“œ í™œì„±í™”
  // - dirty (ìˆ˜ì •ë¨) â†’ ê²€ì¦ ì‹œì‘
  // - submitting (ì œì¶œ ì¤‘) â†’ ë²„íŠ¼ ë¹„í™œì„±í™”
  // - submitted (ì œì¶œ ì™„ë£Œ) â†’ ì„±ê³µ ë©”ì‹œì§€

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <input {...register("email")} />
      {errors.email && <span>ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”</span>}

      <button
        type="submit"
        disabled={isSubmitting} // ğŸ‘ˆ ì œì¶œ ì¤‘ ìƒíƒœì¼ ë•Œ ë¹„í™œì„±í™”
      >
        {isSubmitting ? "ì œì¶œ ì¤‘..." : "ë¡œê·¸ì¸"}
      </button>
    </form>
  );
}
```

```js
// React Hook Form ë‚´ë¶€ (ë‹¨ìˆœí™”)
class FormState {
  private state: FormStateInterface;

  constructor() {
    this.state = new PristineState();
  }

  // ê° ìƒíƒœëŠ” validate, submit ë“±ì„ ë‹¤ë¥´ê²Œ êµ¬í˜„
  validate() {
    return this.state.validate(this);
  }

  submit() {
    return this.state.submit(this);
  }
}

interface FormStateInterface {
  validate(context: FormState): boolean;
  submit(context: FormState): Promise<void>;
}

class PristineState implements FormStateInterface {
  validate(context: FormState): boolean {
    // ì´ˆê¸° ìƒíƒœì—ì„œëŠ” ê²€ì¦ ìŠ¤í‚µ
    return true;
  }

  submit(context: FormState): Promise<void> {
    context.setState(new SubmittingState());
    // ...
  }
}

class SubmittingState implements FormStateInterface {
  validate(context: FormState): boolean {
    // ì œì¶œ ì¤‘ì—ëŠ” ì¶”ê°€ ê²€ì¦ ë¶ˆê°€
    return false;
  }

  submit(context: FormState): Promise<void> {
    // ì´ë¯¸ ì œì¶œ ì¤‘
    throw new Error('Already submitting');
  }
}
```

tanstack query

```js
import { useQuery } from "@tanstack/react-query";

function UserProfile() {
  const { data, status, error, refetch } = useQuery({
    queryKey: ["user"],
    queryFn: fetchUser,
  });

  // statusê°€ ìƒíƒœ ì—­í• 
  // - 'pending' â†’ ë¡œë”© ì¤‘
  // - 'error' â†’ ì—ëŸ¬ ë°œìƒ
  // - 'success' â†’ ì„±ê³µ

  if (status === "pending") return <div>ë¡œë”© ì¤‘...</div>;
  if (status === "error") return <div>ì—ëŸ¬: {error.message}</div>;

  return <div>{data.name}</div>;
}
```

```js
// React Query ë‚´ë¶€ (ë‹¨ìˆœí™”)
class Query {
  private state: QueryState;

  constructor() {
    this.state = new IdleState();
  }

  fetch() {
    this.state.fetch(this);
  }

  refetch() {
    this.state.refetch(this);
  }

  getStatus() {
    return this.state.getStatus();
  }
}

interface QueryState {
  fetch(context: Query): void;
  refetch(context: Query): void;
  getStatus(): 'idle' | 'pending' | 'success' | 'error';
}

class IdleState implements QueryState {
  fetch(context: Query): void {
    context.setState(new PendingState());
    // API í˜¸ì¶œ ì‹œì‘
  }

  refetch(context: Query): void {
    this.fetch(context);
  }

  getStatus() {
    return 'idle' as const;
  }
}

class PendingState implements QueryState {
  fetch(context: Query): void {
    // ì´ë¯¸ í˜ì¹­ ì¤‘
    console.log('Already fetching');
  }

  refetch(context: Query): void {
    // í˜ì¹­ ì¤‘ì—ëŠ” ì¬ì‹œë„ ë¶ˆê°€
    console.log('Cannot refetch while pending');
  }

  getStatus() {
    return 'pending' as const;
  }
}

class SuccessState implements QueryState {
  fetch(context: Query): void {
    // ìºì‹œëœ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë°”ë¡œ ë°˜í™˜
    console.log('Using cached data');
  }

  refetch(context: Query): void {
    context.setState(new PendingState());
    // ë‹¤ì‹œ í˜ì¹­
  }

  getStatus() {
    return 'success' as const;
  }
}

class ErrorState implements QueryState {
  fetch(context: Query): void {
    // ì—ëŸ¬ ìƒíƒœì—ì„œëŠ” ìë™ ì¬ì‹œë„
    context.setState(new PendingState());
  }

  refetch(context: Query): void {
    this.fetch(context);
  }

  getStatus() {
    return 'error' as const;
  }
}
```
