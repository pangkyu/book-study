## í”„ë¡ì‹œ íŒ¨í„´

ì‹¤ì œ ê°ì²´ì— ëŒ€í•œ ì ‘ê·¼ì„ ì œì–´í•˜ê¸° ìœ„í•´ í”„ë¡ì‹œë¥¼ ì œê³µí•˜ëŠ” íŒ¨í„´
ì‹¤ì œ ê°ì²´ì™€ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê¸° ë•Œë¬¸ì— í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” ì°¨ì´ë¥¼ ëŠë¼ì§€ ëª»í•©ë‹ˆë‹¤.

- í”„ë¡ì‹œ íŒ¨í„´ì€ ì ‘ê·¼ ì œì–´ê°€ ëª©ì (ë™ì¼ ì¸í„°í˜ì´ìŠ¤)
- ë°ì½”ë ˆì´í„°ëŠ” ê¸°ëŠ¥ ì¶”ê°€ê°€ ëª©ì (ë™ì¼ ì¸í„°í˜ì´ìŠ¤)
- ì–´ëŒ‘í„°ëŠ” ì¸í„°í˜ì´ìŠ¤ ë³€í™˜ì´ ëª©ì (ë‹¤ë¥¸ ì¸í„°í˜ì´ìŠ¤)

**ì‚¬ìš© ì‹œê¸°**
ì‹¤ì œ ê°ì²´ì— ì§ì ‘ ì ‘ê·¼í•˜ê¸° ì „ì— ì¶”ê°€ì ì¸ ë¡œì§ì´ í•„ìš”í•œ ê²½ìš°ì— ì‚¬ìš©í•©ë‹ˆë‹¤.

- ì ‘ê·¼ ê¶Œí•œì„ ì œì–´í•˜ê³  ì‹¶ì€ ê²½ìš°
- ë¡œê¹…, ìºì‹± ë“± ë¶€ê°€ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê³  ì‹¶ì€ ê²½ìš°
- ë¹„ìš©ì´ í° ê°ì²´ ìƒì„±ì„ ì§€ì—°ì‹œí‚¤ê³  ì‹¶ì€ ê²½ìš°
- ì›ê²© ê°ì²´ì— ëŒ€í•œ ë¡œì»¬ ëŒ€ë¦¬ìê°€ í•„ìš”í•œ ê²½ìš°

**ì›ê²© í”„ë¡ì‹œ**
ë‹¤ë¥¸ ì£¼ì†Œ ê³µê°„(ë‹¤ë¥¸ ì„œë²„/í”„ë¡œì„¸ìŠ¤)ì— ìˆëŠ” ê°ì²´ë¥¼ ë¡œì»¬ì— ìˆëŠ” ê²ƒì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” í”„ë¡ì‹œì…ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ í†µì‹  ë³µì¡ì„±ì„ ìˆ¨ê¸°ê³  ë¡œì»¬ ê°ì²´ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ê²Œ í•©ë‹ˆë‹¤.

ì‹¤ì œ ê°ì²´ê°€ ì›ê²© ì„œë²„ì— ìˆì„ ë•Œ :

- í´ë¼ì´ì–¸íŠ¸ëŠ” ë„¤íŠ¸ì›Œí¬ í†µì‹ , ì§ë ¬í™”/ì—­ì§ë ¬í™”, ì—ëŸ¬ ì²˜ë¦¬ ë“±ì„ ì‹ ê²½ ì“°ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.
- ë¡œì»¬ ê°ì²´ë¥¼ í˜¸ì¶œí•˜ë“¯ì´ ê°„ë‹¨í•˜ê²Œ ì›ê²© ê°ì²´ë¥¼ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
- ë„¤íŠ¸ì›Œí¬ ì¥ì• , retry ë“±ì„ í”„ë¡ì‹œê°€ ì²˜ë¦¬í•©ë‹ˆë‹¤.

![alt text](image-10.png)

**ê°€ìƒ í”„ë¡ì‹œ**
ë¹„ìš©ì´ í° ê°ì²´ ìƒì„±ì„ ì‹¤ì œë¡œ í•„ìš”í•  ë•Œê¹Œì§€ ì§€ì—°í•©ë‹ˆë‹¤.

```ts
// ì‹¤ì œ ê°ì²´ ì¸í„°í˜ì´ìŠ¤
interface VideoStream {
  play(): void;
  getSize(): number;
}

// ì‹¤ì œ ë¹„ìš©ì´ í° ê°ì²´
class RealVideoStream implements VideoStream {
  private url: string;
  private data: Buffer | null = null;

  constructor(url: string) {
    this.url = url;
    this.loadVideo(); // ìƒì„± ì‹œ ë°”ë¡œ ë¡œë“œ (ë¹„ìš© í¼)
  }

  private loadVideo(): void {
    console.log(`ğŸ“¥ ë¹„ë””ì˜¤ ë¡œë”© ì¤‘... ${this.url}`);
    // ì‹¤ì œë¡œëŠ” ë„¤íŠ¸ì›Œí¬ ìš”ì²­, ë””ì½”ë”© ë“± ë¬´ê±°ìš´ ì‘ì—…
    this.data = Buffer.from("video-data");
    console.log("âœ… ë¡œë”© ì™„ë£Œ!");
  }

  play(): void {
    console.log(`â–¶ï¸ ì¬ìƒ: ${this.url}`);
  }

  getSize(): number {
    return this.data?.length || 0;
  }
}

// ê°€ìƒ í”„ë¡ì‹œ
class VideoStreamProxy implements VideoStream {
  private realStream: RealVideoStream | null = null;
  private url: string;

  constructor(url: string) {
    this.url = url;
    console.log("í”„ë¡ì‹œ ìƒì„± (ì‹¤ì œ ë¡œë”©ì€ ì•„ì§ ì•ˆí•¨)");
  }

  play(): void {
    // ì‹¤ì œë¡œ í•„ìš”í•  ë•Œë§Œ ìƒì„± (Lazy Loading)
    if (!this.realStream) {
      this.realStream = new RealVideoStream(this.url);
    }
    this.realStream.play();
  }

  getSize(): number {
    if (!this.realStream) {
      return 0; // ì•„ì§ ë¡œë“œ ì•ˆë¨
    }
    return this.realStream.getSize();
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
const video = new VideoStreamProxy("rtsp://camera1/stream");
// í”„ë¡ì‹œ ìƒì„± (ì‹¤ì œ ë¡œë”©ì€ ì•„ì§ ì•ˆí•¨)

console.log("ë‹¤ë¥¸ ì‘ì—… ìˆ˜í–‰...");

video.play();
// ğŸ“¥ ë¹„ë””ì˜¤ ë¡œë”© ì¤‘... rtsp://camera1/stream
// âœ… ë¡œë”© ì™„ë£Œ!
// â–¶ï¸ ì¬ìƒ: rtsp://camera1/stream
```

**ë³´í˜¸ í”„ë¡ì‹œ**
ì ‘ê·¼ ê¶Œí•œì„ ì œì–´í•˜ëŠ” í”„ë¡ì‹œì…ë‹ˆë‹¤.

```js
interface DeviceControl {
  reboot(): void;
  updateFirmware(version: string): void;
  viewStatus(): string;
}

class Device implements DeviceControl {
  reboot(): void {
    console.log('ğŸ”„ ë””ë°”ì´ìŠ¤ ì¬ë¶€íŒ… ì¤‘...');
  }

  updateFirmware(version: string): void {
    console.log(`â¬†ï¸ íŒì›¨ì–´ ì—…ë°ì´íŠ¸: ${version}`);
  }

  viewStatus(): string {
    return 'ì •ìƒ ì‘ë™ ì¤‘';
  }
}

// ë³´í˜¸ í”„ë¡ì‹œ
class ProtectedDeviceProxy implements DeviceControl {
  private device: Device;
  private userRole: 'admin' | 'operator' | 'viewer';

  constructor(device: Device, userRole: 'admin' | 'operator' | 'viewer') {
    this.device = device;
    this.userRole = userRole;
  }

  reboot(): void {
    if (this.userRole === 'admin') {
      this.device.reboot();
    } else {
      console.log('âŒ ê¶Œí•œ ì—†ìŒ: ê´€ë¦¬ìë§Œ ì¬ë¶€íŒ… ê°€ëŠ¥í•©ë‹ˆë‹¤.');
    }
  }

  updateFirmware(version: string): void {
    if (this.userRole === 'admin') {
      this.device.updateFirmware(version);
    } else {
      console.log('âŒ ê¶Œí•œ ì—†ìŒ: ê´€ë¦¬ìë§Œ íŒì›¨ì–´ ì—…ë°ì´íŠ¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
    }
  }

  viewStatus(): string {
    // ëª¨ë“  ì‚¬ìš©ì ì ‘ê·¼ ê°€ëŠ¥
    return this.device.viewStatus();
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
const device = new Device();

const adminProxy = new ProtectedDeviceProxy(device, 'admin');
adminProxy.reboot(); // ğŸ”„ ë””ë°”ì´ìŠ¤ ì¬ë¶€íŒ… ì¤‘...

const viewerProxy = new ProtectedDeviceProxy(device, 'viewer');
viewerProxy.reboot(); // âŒ ê¶Œí•œ ì—†ìŒ: ê´€ë¦¬ìë§Œ ì¬ë¶€íŒ… ê°€ëŠ¥í•©ë‹ˆë‹¤.
```

**ìºì‹± í”„ë¡ì‹œ**
ë°˜ë³µì ì¸ ìš”ì²­ ê²°ê³¼ë¥¼ ìºì‹±í•©ë‹ˆë‹¤.

```js
interface CameraAPI {
  getSnapshot(cameraId: string): Promise<string>;
}

class RealCameraAPI implements CameraAPI {
  async getSnapshot(cameraId: string): Promise<string> {
    console.log(`ğŸ“¸ API í˜¸ì¶œ: ${cameraId} ìŠ¤ëƒ…ìƒ· ìš”ì²­`);
    // ì‹¤ì œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì‹œë®¬ë ˆì´ì…˜
    await new Promise(resolve => setTimeout(resolve, 1000));
    return `snapshot-${cameraId}-${Date.now()}`;
  }
}

class CachingCameraProxy implements CameraAPI {
  private api: RealCameraAPI;
  private cache: Map<string, { data: string; timestamp: number }> = new Map();
  private cacheExpiry = 5000; // 5ì´ˆ

  constructor(api: RealCameraAPI) {
    this.api = api;
  }

  async getSnapshot(cameraId: string): Promise<string> {
    const cached = this.cache.get(cameraId);
    const now = Date.now();

    // ìºì‹œê°€ ìˆê³  ìœ íš¨í•˜ë©´ ìºì‹œ ë°˜í™˜
    if (cached && now - cached.timestamp < this.cacheExpiry) {
      console.log(`ğŸ’¾ ìºì‹œì—ì„œ ë°˜í™˜: ${cameraId}`);
      return cached.data;
    }

    // ìºì‹œê°€ ì—†ê±°ë‚˜ ë§Œë£Œë˜ë©´ ì‹¤ì œ API í˜¸ì¶œ
    const data = await this.api.getSnapshot(cameraId);
    this.cache.set(cameraId, { data, timestamp: now });
    return data;
  }
}

// ì‚¬ìš© ì˜ˆì‹œ
const api = new RealCameraAPI();
const proxy = new CachingCameraProxy(api);

await proxy.getSnapshot('camera1'); // ğŸ“¸ API í˜¸ì¶œ
await proxy.getSnapshot('camera1'); // ğŸ’¾ ìºì‹œì—ì„œ ë°˜í™˜ (ë¹ ë¦„!)
```

**ë¡œê¹… í”„ë¡ì‹œ**
ë©”ì†Œë“œ í˜¸ì¶œì„ ë¡œê¹…í•©ë‹ˆë‹¤.

```js
interface DataService {
  save(data: any): void;
  load(id: string): any;
}

class RealDataService implements DataService {
  save(data: any): void {
    // ì‹¤ì œ ì €ì¥ ë¡œì§
  }

  load(id: string): any {
    // ì‹¤ì œ ë¡œë“œ ë¡œì§
    return { id, data: 'some data' };
  }
}

class LoggingDataServiceProxy implements DataService {
  private service: RealDataService;

  constructor(service: RealDataService) {
    this.service = service;
  }

  save(data: any): void {
    console.log(`[LOG] save í˜¸ì¶œë¨ - data:`, data);
    const start = performance.now();

    this.service.save(data);

    const duration = performance.now() - start;
    console.log(`[LOG] save ì™„ë£Œ - ì†Œìš”ì‹œê°„: ${duration}ms`);
  }

  load(id: string): any {
    console.log(`[LOG] load í˜¸ì¶œë¨ - id: ${id}`);
    const start = performance.now();

    const result = this.service.load(id);

    const duration = performance.now() - start;
    console.log(`[LOG] load ì™„ë£Œ - ì†Œìš”ì‹œê°„: ${duration}ms`);
    return result;
  }
}
```

**ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ í”„ë¡ì‹œ ê°ì²´**
ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ì–¸ì–´ ë ˆë²¨ì—ì„œ í”„ë¡ì‹œ íŒ¨í„´ì„ ì§€ì›í•©ë‹ˆë‹¤.

```js
const target = {
  message: "Hello",
  count: 0,
};

const handler = {
  get(target: any, property: string) {
    console.log(`ğŸ” ${property} ì†ì„± ì½ê¸°`);
    return target[property];
  },

  set(target: any, property: string, value: any) {
    console.log(`âœï¸ ${property} ì†ì„± ì“°ê¸°: ${value}`);
    target[property] = value;
    return true;
  },
};

const proxy = new Proxy(target, handler);

console.log(proxy.message); // ğŸ” message ì†ì„± ì½ê¸° / Hello
proxy.count = 5; // âœï¸ count ì†ì„± ì“°ê¸°: 5
```

---

ì‹¤ì „ì—ì„œëŠ” í”„ë¡ì‹œ íŒ¨í„´ì˜ ë³€ì¢…ì„ ë” ë§ì´ ë´…ë‹ˆë‹¤.
ë³€ì¢…ì˜ ê³µí†µì ìœ¼ë¡œëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì‹¤ì œ ê°ì²´ì˜ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ê·¸ í˜¸ì¶œì„ ì¤‘ê°„ì— ê°€ë¡œì±•ë‹ˆë‹¤.
-> ê°„ì ‘ì ìœ¼ë¡œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ë©´ ìš”ì²­ ë‚´ì—­ì„ ì›ê²© ì‹œìŠ¤í…œì— ìˆëŠ” ê°ì²´ì— ì „ë‹¬, ìƒì„±í•˜ëŠ” ë° ë§ì€ ë¹„ìš©ì´ ë“œëŠ” ê°ì²´ë¥¼ ëŒ€ë³€
